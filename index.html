<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Telegram Mini App Template</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f0f0f0;
      overflow: hidden; /* Предотвращаем скроллинг тела по умолчанию */
    }
    #app {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
    }
    .label {
      font-size: 24px;
      margin-bottom: 20px;
    }
    .button {
      padding: 10px 20px;
      font-size: 18px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .content {
      overflow-y: auto; /* Разрешаем скроллинг внутри .content, если нужно */
      max-height: 100vh;
    }
    .ios .content {
      /* Дополнительные стили для iOS, если требуется */
    }
    /* Скрываем элементы загрузки и базового приложения, если они не нужны */
    #app-loading, #basic-app {
      display: none;
    }
  </style>
</head>
<body>
  <div id="app-loading">Loading...</div>
  <div id="basic-app"></div>
  <div id="app" class="content">
    <!-- Vue будет рендерить здесь -->
  </div>

  <script>
    // Определяем iOS устройства
    var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      
    // Базовая проверка наличия Telegram WebApp API
    window.addEventListener('DOMContentLoaded', function() {
      // Элементы страницы
      var appLoading = document.getElementById('app-loading');
      var basicApp = document.getElementById('basic-app');
      var vueApp = document.getElementById('app');
      var isAppHidden = false;
      
      // Настраиваем для iOS
      if (isIOS) {
        document.body.classList.add('ios');
        
        // Специальные настройки для iOS полноэкранного режима
        // Предотвращаем скроллинг страницы целиком на iOS
        document.addEventListener('touchmove', function(event) {
          // Разрешаем скроллинг только внутри элементов с классом content
          if (!event.target.closest('.content')) {
            event.preventDefault();
          }
        }, { passive: false });
      }
      
      // Инициализация Telegram API
      var tg = null;
      if (window.Telegram && window.Telegram.WebApp) {
        tg = window.Telegram.WebApp;
        
        // Отключаем свайп вниз для закрытия приложения
        try {
          if (window.Telegram && window.Telegram.WebApp) {
            var eventData = JSON.stringify({ allow_vertical_swipe: false });
            if (window.TelegramWebviewProxy) {
              window.TelegramWebviewProxy.postEvent('web_app_setup_swipe_behavior', eventData);
            } else {
              window.parent.postMessage(JSON.stringify({
                eventType: 'web_app_setup_swipe_behavior',
                eventData: { allow_vertical_swipe: false }
              }), 'https://web.telegram.org');
            }
            console.log('Свайп вниз отключен');
          }
        } catch (e) {
          console.error('Ошибка при отключении свайпа вниз:', e);
        }
        
        // Скрываем кнопку "Назад" в левом верхнем углу
        try {
          if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.BackButton) {
            window.Telegram.WebApp.BackButton.hide();
            console.log('Кнопка "Назад" скрыта');
          }
        } catch (e) {
          console.error('Ошибка при скрытии кнопки "Назад":', e);
        }
        
        // Блокировка ориентации экрана в портретном режиме
        try {
          if (window.Telegram && window.Telegram.WebApp) {
            var orientationData = JSON.stringify({ locked: true });
            if (window.TelegramWebviewProxy) {
              window.TelegramWebviewProxy.postEvent('web_app_toggle_orientation_lock', orientationData);
            } else {
              window.parent.postMessage(JSON.stringify({
                eventType: 'web_app_toggle_orientation_lock',
                eventData: { locked: true }
              }), 'https://web.telegram.org');
            }
            console.log('Ориентация экрана заблокирована');
          }
        } catch (e) {
          console.error('Ошибка при блокировке ориентации экрана:', e);
        }
        
        // Применяем темную тему если нужно
        if (tg.colorScheme === 'dark') {
          document.documentElement.classList.add('dark');
        }
        
        // Настройка переменных CSS на основе Telegram темы
        if (tg.themeParams) {
          document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color);
          document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color);
          document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color);
          document.documentElement.style.setProperty('--tg-theme-link-color', tg.themeParams.link_color);
          document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color);
          document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color);
          document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.themeParams.secondary_bg_color);
        }
        
        // Функция активации полноэкранного режима
        var toggleFullScreen = function() {
          try {
            // Скрываем кнопки
            if (window.Telegram && window.Telegram.WebApp) {
              if (window.Telegram.WebApp.BackButton) window.Telegram.WebApp.BackButton.hide();
              if (window.Telegram.WebApp.MainButton) window.Telegram.WebApp.MainButton.hide();
              if (window.Telegram.WebApp.disableSwipeToClose) window.Telegram.WebApp.disableSwipeToClose();
            }
            
            // Добавляем класс для iOS
            if (isIOS) document.body.classList.add('ios-fullscreen');
            
            // Расширяем окно всеми доступными методами
            if (tg.expand) tg.expand();
            if (tg.requestFullscreen) tg.requestFullscreen();
            if (window.Telegram && window.Telegram.WebApp) {
              if (window.Telegram.WebApp.expand) window.Telegram.WebApp.expand();
              if (window.Telegram.WebApp.setViewportHeight) window.Telegram.WebApp.setViewportHeight(1.0);
            }
            
            // Отправляем событие для расширения
            try {
              var expandData = JSON.stringify({force: true});
              if (window.TelegramWebviewProxy) {
                window.TelegramWebviewProxy.postEvent('web_app_expand', expandData);
              } else {
                window.parent.postMessage(JSON.stringify({
                  eventType: 'web_app_expand',
                  eventData: {force: true}
                }), '*');
              }
            } catch (e) {}
            
            // Устанавливаем viewport
            var viewportMeta = document.querySelector('meta[name="viewport"]');
            if (viewportMeta) {
              viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
            }
          } catch (e) {
            console.error('Ошибка полноэкранного режима:', e);
          }
        };

        // Автоматически активируем полноэкранный режим при загрузке
        // Функция активации полноэкранного режима с повторами
        var activateFullScreenMode = function(attempts) {
          attempts = attempts || 0;
          var maxAttempts = isIOS ? 3 : 2;
          try {
            toggleFullScreen();
            if (isIOS && attempts < maxAttempts) {
              setTimeout(function() {
                activateFullScreenMode(attempts + 1);
              }, 300);
            }
          } catch (e) {
            if (attempts < maxAttempts) {
              setTimeout(function() {
                activateFullScreenMode(attempts + 1);
              }, 300);
            }
          }
        };
        
        // Запускаем активацию полноэкранного режима
        setTimeout(activateFullScreenMode, isIOS ? 500 : 200);
        
        // Дополнительные события для iOS
        if (isIOS) {
          // При загрузке страницы
          window.addEventListener('load', function() {
            setTimeout(activateFullScreenMode, 500);
          });
          
          // При возвращении на страницу
          document.addEventListener('visibilitychange', function() {
            if (!document.hidden) setTimeout(activateFullScreenMode, 300);
          });
          
          // При получении фокуса
          window.addEventListener('focus', function() {
            setTimeout(activateFullScreenMode, 300);
          });
          
          // При восстановлении из кэша
          window.addEventListener('pageshow', function(event) {
            if (event.persisted) setTimeout(activateFullScreenMode, 300);
          });
        }
      } // Закрывающая скобка для if (window.Telegram && window.Telegram.WebApp)

      // Инициализация Vue после DOMContentLoaded
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            message: 'Hello, Telegram Mini App!'
          };
        },
        methods: {
          handleClick() {
            alert('Button clicked!');
            // Здесь можно интегрировать Telegram WebApp API, например:
            // if (window.Telegram && window.Telegram.WebApp) {
            //   window.Telegram.WebApp.showAlert('Button clicked!');
            // }
          }
        },
        template: `
          <div>
            <div class="label">{{ message }}</div>
            <button class="button" @click="handleClick">Click Me</button>
          </div>
        `
      }).mount('#app');

      // Если нужно показать/скрыть элементы
      appLoading.style.display = 'none';
      vueApp.style.display = 'block';
    });
  </script>
</body>
</html>