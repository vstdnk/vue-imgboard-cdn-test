<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/favicon.ico">
    <!-- –ú–µ—Ç–∞—Ç–µ–≥–∏ –¥–ª—è iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="TG Imgboard">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#2678b6">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.json">
    <title>TG Imgboard - –¢—Ä–µ–¥</title>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º Telegram WebApp —Å–∫—Ä–∏–ø—Ç –¥–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ -->
    <style>
      :root {
        --tg-theme-bg-color: #ffffff;
        --tg-theme-text-color: #222222;
        --tg-theme-hint-color: #999999;
        --tg-theme-link-color: #2678b6;
        --tg-theme-button-color: #2678b6;
        --tg-theme-button-text-color: #ffffff;
        --tg-theme-secondary-bg-color: #f5f5f5;
        --safe-area-inset-top: env(safe-area-inset-top, 0px);
        --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
      }
      
      html.dark {
        --tg-theme-bg-color: #212121;
        --tg-theme-text-color: #ffffff;
        --tg-theme-hint-color: #aaaaaa;
        --tg-theme-link-color: #8cc2ff;
        --tg-theme-button-color: #2678b6;
        --tg-theme-button-text-color: #ffffff;
        --tg-theme-secondary-bg-color: #292929;
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      
      html, body {
        height: 100%;
        width: 100%;
        padding: 0;
        margin: 0;
        overflow: hidden;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        -webkit-text-size-adjust: 100%;
        -webkit-font-smoothing: antialiased;
      }
      
      #app {
        height: 100%;
        width: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        position: relative;
        touch-action: pan-y;
      }
      
      #app-loading {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background-color: var(--tg-theme-bg-color);
        color: var(--tg-theme-text-color);
        transition: opacity 0.3s;
        z-index: 9999;
      }
      
      #app-loading.hidden {
        opacity: 0;
        pointer-events: none;
        z-index: -1;
      }
      
      .spinner {
        width: 40px;
        height: 40px;
        margin-bottom: 20px;
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--tg-theme-button-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      html.dark .spinner {
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-left-color: var(--tg-theme-link-color);
      }
      
      .loading-text {
        font-size: 14px;
        letter-spacing: 1px;
        font-weight: bold;
      }
      
             @keyframes spin {
         to { transform: rotate(360deg); }
       }
       
               @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.02); }
          100% { transform: scale(1); }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–≤–∞–π–ø–∞ –≤–ø—Ä–∞–≤–æ */
        @keyframes swipeRight {
          0% { transform: translateX(0); }
          100% { transform: translateX(100%); }
        }
        
        .swipe-indicator {
          position: fixed;
          top: 50%;
          height: 100%;
          left: 0px;
          transform: translateY(-50%);
          background-color: rgba(134, 196, 238, 0.418);
          color: var(--tg-theme-button-text-color);
          padding: 12px 16px;
          border-radius: 20px;
          font-size: 14px;
          font-weight: 500;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.3s ease;
          z-index: 1001;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .swipe-indicator.show {
          opacity: 1;
        }
        
        .swipe-indicator.swiping {
          animation: swipeRight 0.3s ease-out forwards;
        }

      /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤ */
      .thread-container {
        padding: 16px;
        max-width: 1200px;
        margin: 0 auto;
      }

      .thread-header {
        display: flex;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        width: 120%;
        z-index: 1000;
        align-items: center;
        gap: 18px;
        margin-bottom: 24px;
        padding: 16px;
        background-color: rgb(255, 255, 255);
        border-bottom: 1px solid rgba(0,0,0,0.1);
      }

      html.dark .thread-header {
        border-color: rgba(255,255,255,0.1);
        background-color: rgb(22, 22, 22);
      }

      .back-button {
        background-color: rgba(121, 115, 115, 0.1);
        border: 1px solid rgba(71, 49, 49, 0.1);
        font-size: 14px;
        font-weight: bold;
        color: var(--tg-theme-text-color);
        cursor: pointer;
        padding: 8px;
        border-radius: 18px;
        margin-left: 26%;
        margin-top: 8.5%;
        transition: background-color 0.2s ease;
      }

      .back-button:hover {
        background-color: rgba(0,0,0,0.1);
      }

      html.dark .back-button:hover {
        background-color: rgba(255,255,255,0.1);
      }

      .thread-info {
        flex: 1;
      }

      .thread-id {
        font-family: monospace;
        font-weight: bold;
        color: var(--tg-theme-button-color);
        font-size: 18px;
        margin-bottom: 4px;
      }

      .thread-title {
        font-weight: 600;
        font-size: 20px;
        margin-bottom: 8px;
      }

      .thread-description {
        font-size: 14px;
        color: var(--tg-theme-hint-color);
        line-height: 1.4;
      }

      .posts-container {
        display: flex;
        flex-direction: column;
        margin-top: 50%;
        gap: 12px;
        padding: 16px;
      }

      .post-card {
        background-color: var(--tg-theme-bg-color);
        border-radius: 8px;
        padding: 16px;
        transition: all 0.2s ease;
        position: relative;
        border: 1px solid rgba(0,0,0,0.1);
      }

      html.dark .post-card {
        background-color: var(--tg-theme-secondary-bg-color);
        border-color: rgba(255,255,255,0.1);
      }

      .post-card:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(92, 89, 89, 0.1);
        background-color: var(--tg-theme-secondary-bg-color);
      }

      html.dark .post-card:hover {
        background-color: rgba(221, 221, 221, 0.1);
      }

      /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏ */
      .post-card:not(:last-child)::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 16px;
        right: 16px;
        height: 1px;
        background-color: rgba(0, 0, 0, 0.1);
      }

      html.dark .post-card:not(:last-child)::after {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .post-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
        font-size: 14px;
        color: var(--tg-theme-hint-color);
      }

      .post-number {
        font-weight: bold;
        color: var(--tg-theme-button-color);
      }

      .post-date {
        color: var(--tg-theme-hint-color);
      }

      .post-content {
        margin-bottom: 12px;
        line-height: 1.6;
        display: flex;
        gap: 16px;
        align-items: flex-start;
      }

      .post-thumb {
        flex-shrink: 0;
        width: 80px;
        height: 80px;
        border-radius: 6px;
        margin-top: 5px;
        overflow: hidden;
        background-color: var(--tg-theme-secondary-bg-color);
      }

      .post-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.2s ease;
        cursor: zoom-in;
      }

      .post-thumb img:hover {
        transform: scale(1.02);
      }

      .post-info {
        flex: 1;
        min-width: 0;
      }

             .post-text {
         margin-bottom: 12px;
         white-space: pre-wrap;
         word-wrap: break-word;
         line-height: 1.6;
       }
       
       /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö HTML —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
       .post-text strong {
         font-weight: bold;
       }
       
       .post-text em {
         font-style: italic;
       }
       
       .post-text u {
         text-decoration: underline;
       }
       
       .post-text del {
         text-decoration: line-through;
         color: var(--tg-theme-hint-color);
       }
       
       .post-text code {
         background-color: var(--tg-theme-secondary-bg-color);
         padding: 2px 4px;
         border-radius: 3px;
         font-family: monospace;
         font-size: 0.9em;
       }
       
       .post-text .spoiler {
         background-color: var(--tg-theme-text-color);
         color: var(--tg-theme-text-color);
         padding: 2px 4px;
         border-radius: 3px;
         cursor: pointer;
         user-select: none;
         transition: all 0.2s ease;
       }
       
       .post-text .spoiler.revealed {
         background-color: transparent;
         color: inherit;
       }
       
       .post-text .spoiler:hover {
         background-color: var(--tg-theme-hint-color);
       }
       
       .post-text .post-quote {
         border-left: 3px solid var(--tg-theme-hint-color);
         padding-left: 12px;
         margin: 8px 0;
         color: var(--tg-theme-hint-color);
         font-style: italic;
       }
       
               .post-text .post-link {
          color: var(--tg-theme-link-color);
          text-decoration: none;
          font-weight: bold;
          background-color: rgba(38, 120, 182, 0.1);
          padding: 2px 6px;
          border-radius: 4px;
          transition: all 0.2s ease;
          cursor: pointer;
          display: inline-block;
          user-select: none;
          position: relative;
          z-index: 1;
        }
       
       .post-text .post-link:hover {
         background-color: rgba(38, 120, 182, 0.2);
         transform: translateY(-1px);
         box-shadow: 0 2px 4px rgba(38, 120, 182, 0.2);
       }
       
       .post-text .post-link:active {
         transform: translateY(0);
         box-shadow: 0 1px 2px rgba(38, 120, 182, 0.2);
       }
       
       .post-text .external-link {
         color: var(--tg-theme-link-color);
         text-decoration: none;
       }
       
               .post-text .external-link:hover {
          text-decoration: underline;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ—Ç–≤–µ—Ç—ã (–µ—Å–ª–∏ –µ—Å—Ç—å) */
        .post-text .post-reply-link {
          color: var(--tg-theme-link-color);
          text-decoration: none;
          font-weight: bold;
          background-color: rgba(38, 120, 182, 0.05);
          padding: 1px 4px;
          border-radius: 3px;
          transition: all 0.2s ease;
          cursor: pointer;
          display: inline-block;
          user-select: none;
          position: relative;
          z-index: 0;
        }
        
        .post-text .post-reply-link:hover {
          background-color: rgba(38, 120, 182, 0.1);
        }

      .post-files {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
      }
      
      /* –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π 2x2 */
      .post-gallery {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin-top: 12px;
      }
      .post-gallery .gallery-item {
        position: relative;
        width: 100%;
        padding-top: 100%; /* –∫–≤–∞–¥—Ä–∞—Ç */
        overflow: hidden;
        border-radius: 6px;
        background-color: var(--tg-theme-secondary-bg-color);
      }
      .post-gallery .gallery-item img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        cursor: zoom-in;
      }
      
      .post-videos {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 12px;
      }

      .post-file {
        max-width: 200px;
        border-radius: 6px;
        overflow: hidden;
        background-color: var(--tg-theme-secondary-bg-color);
      }

      .post-file img {
        width: 100%;
        height: auto;
        display: block;
        cursor: zoom-in;
      }

      .post-file video {
        width: 100%;
        height: auto;
        display: block;
      }

      .error-message {
        text-align: center;
        padding: 32px;
        color: var(--tg-theme-hint-color);
      }

      .retry-button {
        background-color: var(--tg-theme-button-color);
        color: var(--tg-theme-button-text-color);
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 16px;
        transition: opacity 0.2s ease;
      }

      .retry-button:hover {
        opacity: 0.8;
      }

      .loading-more {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 20px;
        color: var(--tg-theme-hint-color);
        font-size: 14px;
      }

      .spinner.small {
        width: 20px;
        height: 20px;
        border-width: 2px;
      }

      .load-more-button {
        display: flex;
        justify-content: center;
        padding: 20px;
      }

      .load-more-btn {
        background-color: var(--tg-theme-button-color);
        color: var(--tg-theme-button-text-color);
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }

             .load-more-btn:hover {
         opacity: 0.8;
       }
       
       /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
       .post-notification {
         position: fixed;
         top: 20px;
         left: 50%;
         transform: translateX(-50%) translateY(-100px);
         background-color: var(--tg-theme-button-color);
         color: var(--tg-theme-button-text-color);
         padding: 12px 20px;
         border-radius: 8px;
         font-size: 14px;
         font-weight: 500;
         z-index: 10000;
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
         transition: transform 0.3s ease;
         pointer-events: none;
       }
       
       .post-notification.show {
         transform: translateX(-50%) translateY(0);
       }
       
       html.dark .post-notification {
         box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
       }

        /* –ö—Ä–∞—Å–Ω–∞—è –ø–ª–∞—à–∫–∞-–∞–ª–µ—Ä—Ç */
        .alert-banner {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          transform: translateY(-100%);
          background-color: #d32f2f;
          color: #ffffff;
          padding: 12px 16px;
          text-align: center;
          font-size: 14px;
          font-weight: 600;
          z-index: 11000;
          box-shadow: 0 4px 12px rgba(0,0,0,0.25);
          transition: transform 0.25s ease;
        }
        .alert-banner.show {
          transform: translateY(0);
        }
        html.dark .alert-banner {
          background-color: #ef5350;
          box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        /* Lightbox */
        .lightbox-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
          padding: 16px;
        }
        .lightbox-content {
          max-width: 80vw;
          max-height: 85vh;
          display: flex;
          flex-direction: column;
          gap: 12px;
          align-items: center;
        }
        .lightbox-image {
          max-width: 80vw;
          max-height: 80vh;
          object-fit: contain;
          border-radius: 8px;
          box-shadow: 0 6px 24px rgba(0, 0, 0, 0.4);
          background: #000;
          cursor: zoom-out;
        }
        .lightbox-info {
          color: #ffffff;
          font-size: 13px;
          opacity: 0.9;
          text-align: center;
        }
        .lightbox-close {
          position: absolute;
          top: 12px;
          right: 12px;
          color: #ffffff;
          background: rgba(0, 0, 0, 0.45);
          border: none;
          border-radius: 16px;
          padding: 8px 12px;
          cursor: pointer;
        }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
      @media (max-width: 768px) {
        .thread-container {
          padding: 12px;
        }
        
        .thread-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 12px;
          padding: 12px;
        }
        
        .posts-container {
          padding: 12px;
        }
        
        .post-card {
          padding: 12px;
        }
        
        .post-card:not(:last-child)::after {
          left: 12px;
          right: 12px;
        }
        
        .post-files {
          flex-direction: column;
        }
        
        .post-file {
          max-width: 100%;
        }
        
        .post-thumb {
          width: 60px;
          height: 60px;
        }
        
        .post-gallery {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <!-- –ë–∞–∑–æ–≤—ã–π —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="app-loading">
      <div class="spinner"></div>
      <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è Vue –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <div id="app" style="display: none;"></div>

    <script>
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
      var isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
      
      // –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Telegram WebApp API
      window.addEventListener('DOMContentLoaded', function() {
        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        var appLoading = document.getElementById('app-loading');
        var vueApp = document.getElementById('app');
        var isAppHidden = false;
        
        // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const boardId = urlParams.get('board');
        const threadId = urlParams.get('thread');
        
        if (!boardId || !threadId) {
          // –ï—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
          window.location.href = 'index.html';
          return;
        }
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–ª—è iOS
        if (isIOS) {
          document.body.classList.add('ios');
          
          // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ü–µ–ª–∏–∫–æ–º –Ω–∞ iOS
          document.addEventListener('touchmove', function(event) {
            if (event.target.closest('#app') || event.target.closest('.thread-container')) {
              return;
            }
            event.preventDefault();
          }, { passive: false });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram API
        var tg = null;
        if (window.Telegram && window.Telegram.WebApp) {
          tg = window.Telegram.WebApp;
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—É - —Ç–æ–ª—å–∫–æ –¥–ª—è iOS
          const platform = window.Telegram.WebApp.platform;
          if (platform !== 'ios') {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è iPhone
            document.body.innerHTML = `
              <div style="
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
                padding: 20px;
                text-align: center;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
              ">
                <div style="
                  font-size: 24px;
                  font-weight: 600;
                  margin-bottom: 16px;
                  color: #333;
                ">
                  üì± –¢–æ–ª—å–∫–æ –¥–ª—è iPhone
                </div>
                <div style="
                  font-size: 16px;
                  color: #666;
                  line-height: 1.5;
                ">
                  –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ Apple iOS.<br>
                  –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ iPhone –∏–ª–∏ iPad.
                </div>
              </div>
            `;
            return;
          }
          
          // –û—Ç–∫–ª—é—á–∞–µ–º —Å–≤–∞–π–ø –≤–Ω–∏–∑ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
          try {
            if (window.Telegram && window.Telegram.WebApp) {
              var eventData = JSON.stringify({ allow_vertical_swipe: false });
              if (window.TelegramWebviewProxy) {
                window.TelegramWebviewProxy.postEvent('web_app_setup_swipe_behavior', eventData);
              } else {
                window.parent.postMessage(JSON.stringify({
                  eventType: 'web_app_setup_swipe_behavior',
                  eventData: { allow_vertical_swipe: false }
                }), 'https://web.telegram.org');
              }
              console.log('–°–≤–∞–π–ø –≤–Ω–∏–∑ –æ—Ç–∫–ª—é—á–µ–Ω');
            }
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ —Å–≤–∞–π–ø–∞ –≤–Ω–∏–∑:', e);
          }
          
          // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
          try {
            if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.BackButton) {
              window.Telegram.WebApp.BackButton.hide();
              console.log('–ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" —Å–∫—Ä—ã—Ç–∞');
            }
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥":', e);
          }
          
          // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º–Ω—É—é —Ç–µ–º—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
          if (tg.colorScheme === 'dark') {
            document.documentElement.classList.add('dark');
          }
          
          // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö CSS –Ω–∞ –æ—Å–Ω–æ–≤–µ Telegram —Ç–µ–º—ã
          if (tg.themeParams) {
            document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color);
            document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color);
            document.documentElement.style.setProperty('--tg-theme-hint-color', tg.themeParams.hint_color);
            document.documentElement.style.setProperty('--tg-theme-link-color', tg.themeParams.link_color);
            document.documentElement.style.setProperty('--tg-theme-button-color', tg.themeParams.button_color);
            document.documentElement.style.setProperty('--tg-theme-button-text-color', tg.themeParams.button_text_color);
            document.documentElement.style.setProperty('--tg-theme-secondary-bg-color', tg.themeParams.secondary_bg_color);
          }
        }
        
        
         
         // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏
         window.hideLoading = function() {
          if (isAppHidden) return;
          isAppHidden = true;
          
          appLoading.classList.add('hidden');
          
          try {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Vue –ø–æ—Å–ª–µ DOMContentLoaded
            const { createApp } = Vue;

            createApp({
              data() {
                                 return {
                   boardId: boardId,
                   threadId: threadId,
                   threadInfo: null,
                   posts: [],
                   allPosts: [],
                   loading: false,
                   error: null,
                   page: 1,
                   postsPerPage: 20,
                   hasMore: true,
                   loadingMore: false,
                   showSwipeIndicator: false,
                   touchStartX: 0,
                   touchStartY: 0,
                   touchEndX: 0,
                   touchEndY: 0
                 };
              },
              methods: {
                async loadThreadInfo() {
                  try {
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç—Ä–µ–¥–µ
                    // –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É
                    this.threadInfo = {
                      id: this.threadId,
                      boardId: this.boardId,
                      title: '',
                      description: ''
                    };
                  } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–¥–µ:', e);
                  }
                },
                
                async loadPosts() {
                  this.loading = true;
                  this.error = null;
                  this.page = 1;
                  
                  try {
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –ø–æ—Å—Ç—ã
                    const allPosts = await this.fetchPosts();
                    this.allPosts = allPosts;
                     // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—Ä–µ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å—Ç–∞
                     this.updateThreadTitle();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    this.loadNextPage();
                  } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ—Å—Ç–æ–≤:', e);
                    this.error = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å—Ç—ã. –í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ —Å CORS.';
                  } finally {
                    this.loading = false;
                  }
                },
                
                                 loadNextPage() {
                   if (!this.hasMore || this.loadingMore) return;
                   
                   this.loadingMore = true;
                   
                   // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                   setTimeout(() => {
                     const startIndex = (this.page - 1) * this.postsPerPage;
                     const endIndex = startIndex + this.postsPerPage;
                     const newPosts = this.allPosts.slice(startIndex, endIndex);
                     
                     this.posts.push(...newPosts);
                     this.page++;
                     
                     // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –µ—â–µ –ø–æ—Å—Ç—ã
                     this.hasMore = endIndex < this.allPosts.length;
                     this.loadingMore = false;
                     
                     // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤
                     this.$nextTick(() => {
                       this.setupPostLinks();
                     });
                   }, 300);
                 },
                
                onScroll() {
                  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏ –∫–æ–Ω—Ü–∞ —Å–ø–∏—Å–∫–∞
                  const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                  const scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
                  const clientHeight = document.documentElement.clientHeight || window.innerHeight;
                  
                  if (scrollTop + clientHeight >= scrollHeight - 100) {
                    this.loadNextPage();
                  }
                },
                
                async fetchPosts() {
                  // –ò—Å–ø–æ–ª—å–∑—É–µ–º codetabs –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS
                  const proxyUrl = `https://api.codetabs.com/v1/proxy?quest=https://2ch.hk/${this.boardId}/res/${this.threadId}.json`;
                  
                  try {
                    console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã —á–µ—Ä–µ–∑ codetabs –ø—Ä–æ–∫—Å–∏...');
                    const response = await fetch(proxyUrl, {
                      method: 'GET',
                      headers: {
                        'Accept': 'application/json'
                      }
                    });
                    
                    if (response.ok) {
                      const data = await response.json();
                      console.log('–ü–æ—Å—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã —á–µ—Ä–µ–∑ codetabs:', data);
                      return this.parsePosts(data);
                    } else {
                      throw new Error(`HTTP ${response.status}`);
                    }
                  } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ codetabs:', e);
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å—Ç—ã —á–µ—Ä–µ–∑ codetabs –ø—Ä–æ–∫—Å–∏');
                  }
                },
                
                parsePosts(data) {
                  if (data.threads && data.threads[0] && data.threads[0].posts) {
                    return data.threads[0].posts.map(post => ({
                      id: post.num,
                      date: post.date * 1000,
                      text: post.comment || '',
                      files: (post.files || []).map(f => {
                        const guessedThumb = (typeof f.path === 'string' && f.path.includes('/src/'))
                          ? f.path.replace('/src/', '/thumb/')
                          : null;
                        return {
                          path: f.path,
                          thumbnail: f.thumbnail || f.thumbnail_path || f.thumbnail_url || f.preview || guessedThumb,
                          name: f.name || '',
                          size: typeof f.size === 'number' ? f.size : (f.size_bytes || f.filesize || null),
                          type: f.type
                        };
                      }),
                      subject: post.subject || ''
                    }));
                  }
                  
                  return [];
                },
                
                formatTimestamp(timestamp) {
                  if (!timestamp || timestamp === 0) return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                  
                  let date;
                  
                  // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã timestamp
                  if (typeof timestamp === 'string') {
                    date = new Date(timestamp);
                  } else if (timestamp < 10000000000) {
                    date = new Date(timestamp * 1000);
                  } else {
                    date = new Date(timestamp);
                  }
                  
                  if (isNaN(date.getTime()) || date.getFullYear() < 2000) {
                    date = new Date();
                  }
                  
                  // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–¥.–º–º.–≥–≥
                  const day = date.getDate().toString().padStart(2, '0');
                  const month = (date.getMonth() + 1).toString().padStart(2, '0');
                  const year = date.getFullYear().toString().slice(-2);
                  
                  return `${day}.${month}.${year}`;
                },
                
                goBack() {
                  window.location.href = `board.html?id=${this.boardId}`;
                },
                
                                 retryLoad() {
                   this.loadPosts();
                 },
                 
                 processPostText(text) {
                   if (!text) return '';
                   
                   // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º HTML —Ç–µ–≥–∏
                   let processedText = text
                     // –ó–∞–º–µ–Ω—è–µ–º <br> –Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
                     .replace(/<br\s*\/?>/gi, '<br>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å—Ç—ã (>>123456) - —Å–æ–∑–¥–∞–µ–º span —Å data-–∞—Ç—Ä–∏–±—É—Ç–æ–º
                     .replace(/>>(\d+)(?![^<]*>)/g, '<span class="post-link" data-post="$1">>>$1</span>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ >>123456 (—Å –ø—Ä–æ–±–µ–ª–∞–º–∏)
                     .replace(/(?<!<[^>]*)(>>\s*(\d+))/g, '<span class="post-link" data-post="$2">>>$2</span>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ç—Ä–µ–¥—ã
                     .replace(/<a\s+href="([^"]+)"[^>]*>([^<]+)<\/a>/gi, '<a href="$1" target="_blank" class="external-link">$2</a>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
                     .replace(/<b>([^<]+)<\/b>/gi, '<strong>$1</strong>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫—É—Ä—Å–∏–≤
                     .replace(/<i>([^<]+)<\/i>/gi, '<em>$1</em>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç
                     .replace(/<u>([^<]+)<\/u>/gi, '<u>$1</u>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç
                     .replace(/<s>([^<]+)<\/s>/gi, '<del>$1</del>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–¥
                     .replace(/<code>([^<]+)<\/code>/gi, '<code class="post-code">$1</code>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–ø–æ–π–ª–µ—Ä—ã
                     .replace(/<spoiler>([^<]+)<\/spoiler>/gi, '<span class="spoiler" onclick="this.classList.toggle(\'revealed\')">$1</span>')
                     // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ü–∏—Ç–∞—Ç—ã
                     .replace(/<quote>([^<]+)<\/quote>/gi, '<blockquote class="post-quote">$1</blockquote>');
                   
                   return processedText;
                 },
                 
                 setupPostLinks() {
                   // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                   if (this.postLinksHandler) {
                     document.removeEventListener('click', this.postLinksHandler);
                   }
                   
                   // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                  this.postLinksHandler = (e) => {
                    const el = e.target;
                    if (el && el.classList && el.classList.contains('post-link')) {
                       e.preventDefault();
                       e.stopPropagation();
                       
                      const postNum = el.getAttribute('data-post');
                       if (postNum) {
                         this.scrollToPost(postNum);
                       }
                     }
                   };
                   
                   // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                   document.addEventListener('click', this.postLinksHandler);
                 },
                 

                 
                  scrollToPost(postNum) {
                    const normalized = Number(postNum);
                    if (!normalized || normalized < 1) {
                      this.showAlert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç');
                      return;
                    }
                    // –ò—â–µ–º –ø–æ—Å—Ç –≤ DOM
                    const postElement = document.querySelector(`[data-post-id="${normalized}"]`);
                    if (postElement) {
                      postElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                      postElement.style.backgroundColor = 'rgba(38, 120, 182, 0.15)';
                      postElement.style.border = '2px solid var(--tg-theme-button-color)';
                      setTimeout(() => {
                        postElement.style.backgroundColor = '';
                        postElement.style.border = '';
                      }, 1200);
                      postElement.style.animation = 'pulse 0.6s ease-in-out';
                      setTimeout(() => { postElement.style.animation = ''; }, 600);
                      return;
                    }
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π –ø–æ—Å—Ç –≤ –¥–∞–Ω–Ω—ã—Ö
                    const existsInData = Array.isArray(this.allPosts) && this.allPosts.some(p => p.id == normalized);
                    if (!existsInData) {
                      this.showAlert(`–ü–æ—Å—Ç #${normalized} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                      return;
                    }
                    // –ü–æ—Å—Ç –µ—Å—Ç—å, –Ω–æ –Ω–µ –æ—Ç—Ä–∏—Å–æ–≤–∞–Ω ‚Äî –¥–æ–≥—Ä—É–∂–∞–µ–º
                    this.loadPostAndScroll(normalized);
                  },

                  updateThreadTitle() {
                    try {
                      if (!this.threadInfo) {
                        this.threadInfo = { id: this.threadId, boardId: this.boardId, title: '', description: '' };
                      }
                      if (Array.isArray(this.allPosts) && this.allPosts.length > 0) {
                        const opWithSubject = this.allPosts.find(p => p.subject && String(p.subject).trim().length > 0);
                        const op = opWithSubject || this.allPosts[0];
                        let title = '';
                        if (op.subject && String(op.subject).trim().length > 0) {
                          title = String(op.subject).trim();
                        } else if (op.text) {
                          // –ë–µ—Ä–µ–º –Ω–µ–º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å—Ç–∞ –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–æ–∫, —É–±–∏—Ä–∞—è HTML
                          const plain = String(op.text)
                            .replace(/<br\s*\/?>(\r?\n)?/gi, ' ')
                            .replace(/<[^>]*>/g, ' ')
                            .replace(/\s+/g, ' ')
                            .trim();
                          title = plain.slice(0, 80) || '';
                        }
                        if (title) {
                          this.threadInfo.title = title;
                        } else {
                          this.threadInfo.title = '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
                        }
                      }
                    } catch (e) {
                      console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—Ä–µ–¥–∞:', e);
                    }
                  },
                 
                  async loadPostAndScroll(postNum) {
                    if (this.hasMore) {
                      await this.loadAllPosts();
                    }
                    // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –¥–æ–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç —Ç–∞–∫ –∏ –Ω–µ –ø–æ—è–≤–∏–ª—Å—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª–µ—Ä—Ç
                    const existsInData = Array.isArray(this.allPosts) && this.allPosts.some(p => p.id == postNum);
                    if (!existsInData) {
                      this.showAlert(`–ü–æ—Å—Ç #${postNum} –Ω–µ –Ω–∞–π–¥–µ–Ω`);
                      return;
                    }
                    this.$nextTick(() => { this.scrollToPost(postNum); });
                  },
                 
                 async loadAllPosts() {
                   try {
                     // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –ø–æ—Å—Ç—ã
                     let attempts = 0;
                     const maxAttempts = 50; // –ó–∞—â–∏—Ç–∞ –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
                     
                     while (this.hasMore && attempts < maxAttempts) {
                       await this.loadNextPage();
                       attempts++;
                       
                       // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–≥—Ä—É–∑–∫–∞–º–∏
                       if (this.hasMore) {
                         await new Promise(resolve => setTimeout(resolve, 100));
                       }
                     }
                     
                     if (attempts >= maxAttempts) {
                       console.warn('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤');
                       this.hasMore = false;
                     }
                   } catch (e) {
                     console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤:', e);
                     this.hasMore = false;
                   }
                 },
                 
                  // –í–∏–∑—É–∞–ª—å–Ω—ã–π –∞–ª–µ—Ä—Ç —Å–≤–µ—Ä—Ö—É (–∫—Ä–∞—Å–Ω–∞—è –ø–ª–∞—à–∫–∞)
                  showAlert(message) {
                    let banner = document.querySelector('.alert-banner');
                    if (!banner) {
                      banner = document.createElement('div');
                      banner.className = 'alert-banner';
                      document.body.appendChild(banner);
                    }
                    banner.textContent = message;
                    requestAnimationFrame(() => banner.classList.add('show'));
                    clearTimeout(this._alertTimer);
                    this._alertTimer = setTimeout(() => {
                      banner.classList.remove('show');
                    }, 2500);
                  },
                  
                  // –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤
                  isImage(file) {
                    if (!file) return false;
                    if (file.type === 0) return true;
                    const name = (file.name || file.path || '').toLowerCase();
                    return /(\.jpg|\.jpeg|\.png|\.gif|\.webp|\.bmp)$/.test(name);
                  },
                  isVideo(file) {
                    if (!file) return false;
                    if (file.type === 1) return true;
                    const name = (file.name || file.path || '').toLowerCase();
                    return /(\.mp4|\.webm|\.mov|\.m4v|\.avi)$/.test(name);
                  },
                  
                  getPrimaryImage(post) {
                    if (!post || !post.files) return null;
                    const image = post.files.find(f => this.isImage(f));
                    return image || null;
                  },
                  getOtherFiles(post) {
                    if (!post || !post.files) return [];
                    const shown = this.getPrimaryImage(post);
                    return post.files.filter(f => !shown || f !== shown);
                  },
                  getOtherImages(post) {
                    return this.getOtherFiles(post).filter(f => this.isImage(f));
                  },
                  getVideos(post) {
                    if (!post || !post.files) return [];
                    return post.files.filter(f => this.isVideo(f));
                  },
                  
                  // Lightbox
                  openImage(file) {
                    const fullSrc = 'https://2ch.hk' + file.path;
                    const kb = file.size ? Math.round(Number(file.size) / 1024) : null;
                    const info = `${file.name || 'image'}${kb ? ` ‚Ä¢ ${kb} KB` : ''}`;
                    this.showLightbox(fullSrc, info);
                  },
                  showLightbox(src, infoText) {
                    // –°–æ–∑–¥–∞–µ–º overlay
                    const overlay = document.createElement('div');
                    overlay.className = 'lightbox-overlay';
                    overlay.addEventListener('click', () => document.body.removeChild(overlay));
                    
                    const content = document.createElement('div');
                    content.className = 'lightbox-content';
                    
                    const img = document.createElement('img');
                    img.className = 'lightbox-image';
                    img.src = src;
                    img.alt = infoText || '';
                    
                    const info = document.createElement('div');
                    info.className = 'lightbox-info';
                    info.textContent = infoText || '';
                    
                    const close = document.createElement('button');
                    close.className = 'lightbox-close';
                    close.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
                    close.addEventListener('click', (e) => {
                      e.stopPropagation();
                      document.body.removeChild(overlay);
                    });
                    
                    content.appendChild(img);
                    content.appendChild(info);
                    overlay.appendChild(content);
                    overlay.appendChild(close);
                    document.body.appendChild(overlay);
                  },
                 
                 // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–∞ –≤–ø—Ä–∞–≤–æ
                 handleTouchStart(e) {
                   this.touchStartX = e.touches[0].clientX;
                   this.touchStartY = e.touches[0].clientY;
                 },
                 
                 handleTouchMove(e) {
                   this.touchEndX = e.touches[0].clientX;
                   this.touchEndY = e.touches[0].clientY;
                   
                   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –≤–ø—Ä–∞–≤–æ
                   const deltaX = this.touchEndX - this.touchStartX;
                   const deltaY = Math.abs(this.touchEndY - this.touchStartY);
                   
                   if (deltaX > 50 && deltaY < 100) {
                     this.showSwipeIndicator = true;
                   }
                 },
                 
                  handleTouchEnd(e) {
                    // –ï—Å–ª–∏ –±—ã–ª –∫–ª–∏–∫/—Ç–∞–ø –≤–Ω—É—Ç—Ä–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–∫–∞—Ä—Ç–∏–Ω–∫–∞, —Å—Å—ã–ª–∫–∞ –∏ —Ç.–ø.) ‚Äî –Ω–µ —Ç—Ä–∏–≥–≥–µ—Ä–∏–º –Ω–∞–∑–∞–¥
                    const target = e && e.target ? e.target : null;
                    if (target && (target.closest('.post-link') || target.closest('a') || target.closest('img') || target.closest('video') || target.closest('.load-more-btn'))) {
                      this.showSwipeIndicator = false;
                      return;
                    }
                   const deltaX = this.touchEndX - this.touchStartX;
                   const deltaY = Math.abs(this.touchEndY - this.touchStartY);
                   
                   // –ï—Å–ª–∏ —Å–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–π –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π
                   if (deltaX > 100 && deltaY < 100) {
                     this.triggerSwipeBack();
                   }
                   
                   // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                   this.showSwipeIndicator = false;
                 },
                 
                 triggerSwipeBack() {
                   // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —Å–≤–∞–π–ø–∞
                   const indicator = document.querySelector('.swipe-indicator');
                   if (indicator) {
                     indicator.classList.add('swiping');
                   }
                   
                   // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –¥–ª—è –ø–æ–∫–∞–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
                   setTimeout(() => {
                     this.goBack();
                   }, 300);
                 }
              },
              
                                                            mounted() {
                  this.loadThreadInfo();
                  this.loadPosts();
                  
                  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                  window.addEventListener('scroll', this.onScroll);
                  
                  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–≤–∞–π–ø–∞
                  document.addEventListener('touchstart', this.handleTouchStart, { passive: true });
                  document.addEventListener('touchmove', this.handleTouchMove, { passive: true });
                  document.addEventListener('touchend', this.handleTouchEnd, { passive: true });
                  
                  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º –Ω–∞ –ø–æ—Å—Ç—ã
                  this.$nextTick(() => {
                    this.setupPostLinks();
                  });
                  
                  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ Vue –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ
                  window.vueAppInstance = this;
                },
              
                                             beforeUnmount() {
                  // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞
                  window.removeEventListener('scroll', this.onScroll);
                  
                  // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–≤–∞–π–ø–∞
                  document.removeEventListener('touchstart', this.handleTouchStart);
                  document.removeEventListener('touchmove', this.handleTouchMove);
                  document.removeEventListener('touchend', this.handleTouchEnd);
                  
                  // –£–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º
                  if (this.postLinksHandler) {
                    document.removeEventListener('click', this.postLinksHandler);
                  }
                },
              
                             template: `
                 <div class="thread-container">
                   <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–≤–∞–π–ø–∞ –≤–ø—Ä–∞–≤–æ -->
                   <div class="swipe-indicator" :class="{ show: showSwipeIndicator }">
                     &nbsp;
                   </div>
                   
                    <div class="thread-header">
                      <button class="back-button" @click="goBack">–ö —Å–ø–∏—Å–∫—É —Ç—Ä–µ–¥–æ–≤</button>
                      <div class="thread-info">
                        <div class="thread-id">/{{ boardId }}/#{{ threadId }}</div>
                        <div class="thread-title">{{ threadInfo?.title }}</div>
                        <div class="thread-description" v-if="threadInfo?.description">{{ threadInfo.description }}</div>
                      </div>
                    </div>
                  
                  <div v-if="loading" class="error-message">
                    <div class="spinner"></div>
                    <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                  </div>
                  
                  <div v-else-if="error" class="error-message">
                    <div>{{ error }}</div>
                    <button class="retry-button" @click="retryLoad">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                  </div>
                  
                   <div v-else-if="posts.length > 0" class="posts-container">
                                         <div v-for="post in posts" :key="post.id" class="post-card" :data-post-id="post.id">
                      <div class="post-header">
                        <span class="post-number">#{{ post.id }}</span>
                        <span class="post-date">{{ formatTimestamp(post.date) }}</span>
                      </div>
                      
                       <div class="post-content">
                         <div v-if="getPrimaryImage(post)" class="post-thumb">
                           <img
                             :src="'https://2ch.hk' + (getPrimaryImage(post).thumbnail || getPrimaryImage(post).path)"
                             :alt="getPrimaryImage(post).name"
                             loading="lazy"
                             @click="openImage(getPrimaryImage(post))"
                             @error="e => { const img = e.target; const p = getPrimaryImage(post); if (p && p.path) img.src = 'https://2ch.hk' + p.path; }"
                           >
                         </div>
                         <div class="post-info">
                           <div v-if="post.subject" class="post-subject" style="font-weight: bold; margin-bottom: 8px;">
                             {{ post.subject }}
                           </div>
                           <div v-if="post.text" class="post-text" v-html="processPostText(post.text)"></div>

                           <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π 2x2 -->
                           <div v-if="getOtherImages(post).length > 0" class="post-gallery">
                             <div v-for="imgFile in getOtherImages(post)" :key="imgFile.path" class="gallery-item">
                               <img
                                 :src="'https://2ch.hk' + (imgFile.thumbnail || imgFile.path)"
                                 :alt="imgFile.name"
                                 loading="lazy"
                                 @click="openImage(imgFile)"
                                 @error="e => { const el = e.target; if (imgFile.path) el.src = 'https://2ch.hk' + imgFile.path; }"
                               >
                             </div>
                           </div>

                           <!-- –í–∏–¥–µ–æ –Ω–∏–∂–µ -->
                           <div v-if="getVideos(post).length > 0" class="post-videos">
                             <video v-for="vid in getVideos(post)" :key="vid.path" :src="'https://2ch.hk' + vid.path" controls preload="metadata"></video>
                           </div>
                         </div>
                       </div>
                    </div>
                    
                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ -->
                    <div v-if="loadingMore" class="loading-more">
                      <div class="spinner small"></div>
                      <span>–ó–∞–≥—Ä—É–∂–∞–µ–º –µ—â–µ –ø–æ—Å—Ç—ã...</span>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ" –µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞ -->
                    <div v-if="hasMore && !loadingMore && posts.length > 0" class="load-more-button">
                      <button @click="loadNextPage" class="load-more-btn">
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â–µ –ø–æ—Å—Ç—ã
                      </button>
                    </div>
                  </div>
                  
                  <div v-else class="error-message">
                    <div>–ü–æ—Å—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>
                    <button class="retry-button" @click="retryLoad">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
                  </div>
                </div>
              `
             }).mount('#app');

            // Lightbox –∫–æ—Ä–Ω–µ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —á–µ—Ä–µ–∑ Vue template –Ω–∏–∂–µ)

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
            appLoading.style.display = 'none';
            vueApp.style.display = 'block';
          } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Vue:', e);
          }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(function() {
          if (window.Telegram && window.Telegram.WebApp) {
            try {
              // –°–æ–æ–±—â–∞–µ–º Telegram —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
              window.Telegram.WebApp.ready();
              window.Telegram.WebApp.expand();
              
              // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
              document.documentElement.style.height = '100%';
              document.body.style.height = '100%';
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram WebApp:', e);
            }
          }
          
          // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
          setTimeout(function() {
            window.hideLoading();
          }, isIOS ? 1000 : 500);
        }, 100);
        
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞: —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
          setTimeout(function() {
            window.hideLoading();
          }, 500);
        });
      });
    </script>
  </body>
</html>
